<!-- @format -->

## DNS의 정의

> DNS = Domain Name System

- DNS란 인터넷 전화번호부
- 웹 브라우저는 `IP주소`를 통해 상호작용하는데, 이는 사람이 기억하고 읽기에 불편하다. 따라서 사람은 naver, google같은 영어로 된 도메인을 사용하여 웹에 접속한다. DNS는 브라우저가 영어로 된 `도메인` 이름을 IP주소로 변환하는 역할을 해준다.

## DNS 작동 방식

### 웹 페이지 로딩에 4개의 DNS 서버가 연관되어 있음

1. DNS 리커서

- 클라이언트 컴퓨터로부터 쿼리를 받음
- 이름 서버로부터 응답을 받아서 클라이언트로 전달

2. 루트 이름 서버

- 사람이 읽을 수 있는 호스트 이름을 IP주소로 변환하는 첫번째 단계
- 다른 특정한 위치에 대한 참조로 사용됨

3. TLD(최상위 도메인) 이름 서버

- 호스트 이름의 마지막 부분을 호스팅
- `google.com`에서 `com` 담당

4. 권한 이름 있는 서버

- 최종 이름 서버, 특정 이름을 해당 정의로 변환
- 이름 서버 쿼리의 종착점
- 이 서버가 요청한 레코드에 대한 엑세스 권한이 있다면 요청한 호스트 이름의 IP주소를 DNS리커서에게 보냄

### 도메인 네임스페이스 트리

![](https://images.velog.io/images/dandev_sw/post/a100d86b-9862-4fa1-a53a-8023633b9f99/image.png)

### 권한 있는 DNS서버와 재귀 DNS 확인자

1. 재귀 DNS 확인자

![](https://images.velog.io/images/dandev_sw/post/ad9b59fb-bff5-45b2-b891-7edd3a33c0e1/image.png)

- 클라이언트의 재귀 요청에 응답, DNS레코드 추적하는 컴퓨터
- 요청에 대해 권한 있는 DNS이름 서버에 도달할 때까지 재귀적으로 계속 서치함
- 보통은 캐싱해서, 이 확인자가 매번 돌지 않아도 됨

2. 권한 있는 DNS 서버

![](https://images.velog.io/images/dandev_sw/post/3bb7854a-d875-413f-97f2-47bf528bf7c7/image.png)

- 실제로 DNS 리소스 레코드를 보유하고 담당하는 서버
- 조회 체인의 맨 아래에 있는 서버, 자체 데이터로 쿼리를 충족시킴

3. 하위 도메인

![](https://images.velog.io/images/dandev_sw/post/96fe3259-ae3e-40d4-bc48-03dce22ae9db/image.png)

- 추가 이름 서버가 권한있는 이름 서버 다음 시퀀스에 추가
- 추가 이름 서버가 하위 도메인의 CNAME 레코드 저장을 담당

### DNS 조회 단계

> 웹 브라우저 → DNS서버 → 웹 브라우저

![](https://images.velog.io/images/dandev_sw/post/88f8d74b-fd9e-48cd-a2b2-7e8c970e1ae6/image.png)

1. 사용자가 웹 브라우저에 'example.com'을 입력하면, 쿼리가 인터넷으로 이동하고 DNS 재귀 확인자가 이를 수신합니다.
2. 이어서 확인자가 DNS 루트 이름 서버(.)를 쿼리합니다.
3. 다음으로, 루트 서버가, 도메인에 대한 정보를 저장하는 최상위 도메인(TLD) DNS 서버(예: .com 또는 .net)의 주소로 확인자에 응답합니다. example.com을 검색할 경우의 요청은 .com TLD를 가리킵니다.
4. 이제, 확인자가 .com TLD에 요청합니다.
5. 이어서, TLD 서버가 도메인 이름 서버(example.com)의 IP 주소로 응답합니다.
6. 마지막으로, 재귀 확인자가 도메인의 이름 서버로 쿼리를 보냅니다.
7. 이제, example.com의 IP 주소가 이름 서버에서 확인자에게 반환됩니다.
8. 이어서, DNS 확인자가, 처음 요청한 도메인의 IP 주소로 웹 브라우저에 응답합니다. DNS 조회의 8단계를 거쳐 example.com의 IP 주소가 반환되면, 이제 브라우저가 웹 페이지를 요청할 수 있습니다.
9. 브라우저가 IP 주소로 **[HTTP](https://www.cloudflare.com/ko-kr/learning/ddos/glossary/hypertext-transfer-protocol-http)** 요청을 보냅니다.
10. 해당 IP의 서버가 브라우저에서 렌더링할 웹 페이지를 반환합니다(10단계).

### DNS 쿼리 유형

1. 재귀 쿼리

- 확인자가 레코드를 찾을 수 없는 경우 DNS 클라이언트는 DNS 서버가 자원 레코드 또는 오류 메세지를 사용하여 클라이언트에 응답하도록 요구한다.

2. 반복 쿼리

- DNS 서버가 가능한 최상의 응답을 반환하도록 한다.
- 쿼리 이름이랑 일치하지 않는 경우 하위 수준에서 권한 있는 DNS에 대한 참조라도 반환함

3. 비재귀 쿼리

- 클라이언트의 쿼리를 받은 DNS서버가 해당 레코드에 대한 권한이 있거나 캐시 내부에 해당 레코드를 갖고 있어서 DNS 서버가 엑세스 권한을 갖고 있는 레코드를 쿼리할 때 발생한다.

## DNS 캐싱

> DNS 쿼리 조기 확인, DNS 조회 체인의 추가 쿼리 피해 로드 시간 향상, CPU소비 줄임

### 브라우저 DNS 캐싱

- 최신 웹 브라우저는 정해진 시간 동안 DNS 레코드를 캐시하도록 설계되어있음
- DNS 레코드를 요청할 때, 브라우저 캐시에서 처음으로, 요청한 레코드를 확인!

### OS수준 DNS 캐싱

- DNS 쿼리의 마지막 로컬 중단점
- 자체 캐시를 검사하여 레코드가 있는지 확인, 레코드가 없으면 DNS 쿼리를 DNS 재귀 확인자로 보냄
